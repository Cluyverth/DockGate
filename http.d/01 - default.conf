# This is a default site configuration which will simply return 404, preventing
# chance access to any other virtualhost.

server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;

    # No global error pages

    # Reject all requests with a 404 response
    location / {
        return 404;
    }

    # Serve a proper 404 error page internally to avoid recursion
    location = /404.html {
        internal;
    }

    # Block common bot scanning paths to reduce server load
    location ~* /(phpmyadmin|wp-login.php|xmlrpc.php|admin|login) {
        return 403;
    }

    # Block requests with suspicious query strings
    if ($query_string ~* "(union.*select.*\(|select.*from.*information_schema.tables|select.*from.*mysql.db)") {
        return 403;
    }

    # Prevent access to hidden files (dotfiles like .git, .env)
    location ~ /\. {
        return 403;
    }

    # Prevent access to backup and config files
    location ~* \.(old|bak|swp|sql|tgz|tar.gz|zip)$ {
        return 403;
    }
}